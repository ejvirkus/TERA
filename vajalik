import csv
import folium
import webbrowser

class GPSPlotter:
    def __init__(self, csv_file):
        self.csv_file = csv_file
        self.map = None  # Initialize the map later once we have coordinates
        self.polyline = folium.PolyLine(locations=[], color='blue')

    def plot_from_csv(self):
        points = []
        with open(self.csv_file, 'r') as file:
            reader = csv.DictReader(file)
            for row in reader:
                latitude = float(row['Latitude'])
                longitude = float(row['Longitude'])
                points.append([latitude, longitude])
                folium.Marker([latitude, longitude], popup='GPS Location').add_to(self.map)

        if points:
            # Initialize the map at the first coordinate if points exist
            self.map = folium.Map(location=points[0], zoom_start=10, tiles=None)
        else:
            # Handle the case where no valid points are found
            print("No valid GPS coordinates found in the CSV file.")
            return

        self.polyline.locations = points
        self.polyline.add_to(self.map)

        folium.TileLayer(
            tiles='https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
            attr='Esri',
            name='Esri Satellite',
            overlay=True
        ).add_to(self.map)

        folium.LayerControl().add_to(self.map)

        map_file_path = 'gps_map.html'
        self.map.save(map_file_path)

        webbrowser.open(map_file_path)

def main():
    csv_file = 'gps_data_tera.csv'
    gps_plotter = GPSPlotter(csv_file)
    gps_plotter.plot_from_csv()

if __name__ == '__main__':
    main()



tera@ubuntu:~$ /bin/python /home/tera/ros2_ws/src/gps_data/gps_data/gps_live_map.py
Traceback (most recent call last):
  File "/home/tera/.local/lib/python3.10/site-packages/folium/utilities.py", line 115, in _validate_locations_basics
    next(iter(locations))
StopIteration

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/tera/ros2_ws/src/gps_data/gps_data/gps_live_map.py", line 52, in <module>
    main()
  File "/home/tera/ros2_ws/src/gps_data/gps_data/gps_live_map.py", line 48, in main
    gps_plotter = GPSPlotter(csv_file)
  File "/home/tera/ros2_ws/src/gps_data/gps_data/gps_live_map.py", line 9, in __init__
    self.polyline = folium.PolyLine(locations=[], color='blue')
  File "/home/tera/.local/lib/python3.10/site-packages/folium/vector_layers.py", line 190, in __init__
    super().__init__(locations, popup=popup, tooltip=tooltip)
  File "/home/tera/.local/lib/python3.10/site-packages/folium/vector_layers.py", line 139, in __init__
    self.locations = validate_multi_locations(locations)
  File "/home/tera/.local/lib/python3.10/site-packages/folium/utilities.py", line 132, in validate_multi_locations
    _validate_locations_basics(locations)
  File "/home/tera/.local/lib/python3.10/site-packages/folium/utilities.py", line 117, in _validate_locations_basics
    raise ValueError("Locations is empty.")
ValueError: Locations is empty.
